<div id="alarm-timer" role="status" aria-live="polite" class="timer-display">
  {% if config.get('enabled', False) %}
    {{ t('alarm_set', time=config.time) }}
    {% if config.get('alarm_volume') %}
      <span class="volume-info">{{ t('alarm_volume_info', volume=config.alarm_volume) }}</span>
    {% endif %}
  {% else %}
    {{ t('no_alarm') }}
  {% endif %}
</div>

<!-- Empty State (shown when no alarm is configured and form is hidden) -->
<div class="empty-state {% if config.get('enabled', False) or config.get('time') %}hidden{% endif %}" id="alarm-empty-state">
  <div class="empty-state-icon">
    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/>
      <path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72z"/>
    </svg>
  </div>
  <h3 class="empty-state-title">{{ t('empty_alarm_title') }}</h3>
  <p class="empty-state-description">{{ t('empty_alarm_description') }}</p>
</div>

<form method="POST" aria-labelledby="alarm-form-title" id="alarm-form" 
      data-current-playlist-uri="{{ config.get('playlist_uri', '') }}"
      class="{% if config.get('enabled', False) %}hidden{% endif %}">
  <h2 id="alarm-form-title" class="form-title">{{ t('alarm_configure') }}</h2>

  <!-- Music Selection -->
  <div class="form-group">
    <div id="alarm-playlist-selector">
      <div class="playlist-input">
        <div class="playlist-preview">
          <div class="playlist-preview-image"><svg class="icon icon-2x" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg></div>
          <div class="playlist-preview-info">
            <div class="playlist-preview-name">{{ t('playlist_select_text') or 'Select music' }}</div>
            <div class="playlist-preview-meta"></div>
          </div>
        </div>
      </div>
    </div>
    <small id="alarm-playlist-help" class="form-help">{{ t('playlist_help') }}</small>
  </div>

  <!-- Alarm Time -->
  <div class="form-group">
    <label for="time" class="alarm-time-label">{{ t('alarm_time_label')|safe }}</label>
    <input 
      type="time" 
      id="time" 
      name="time" 
      value="{{ config.time }}" 
      required 
      class="alarm-time-input"
      aria-describedby="time-help"
    >
    <small id="time-help" class="form-help">{{ t('alarm_time_help') }}</small>
  </div>

  <!-- Speaker Device -->
  <div class="form-group">
    <label for="alarm-device-name">{{ t('device_label')|safe }}</label>
    <select 
      name="device_name" 
      id="alarm-device-name" 
      class="form-input" 
      required
      aria-describedby="alarm-device-help"
    >
      {% if not devices %}
        <option value="" disabled selected>{{ t('loading_devices') or 'Lade Geräte…' }}</option>
      {% endif %}
      {% for d in devices %}
        <option value="{{ d.name }}" {% if config.device_name == d.name %}selected{% endif %}>
          {{ d.name }}
        </option>
      {% endfor %}
    </select>
    <small id="alarm-device-help" class="form-help">{{ t('device_help') }}</small>
  </div>

  <!-- Alarm Volume Control -->
  <div class="form-group">
    <label for="alarm_volume_slider">{{ t('alarm_volume')|safe }}</label>
    <div class="volume-control">
      <input 
        type="range" 
        id="alarm_volume_slider" 
        name="alarm_volume"
        min="5" 
        max="100" 
        value="{{ config.get('alarm_volume', 50) }}" 
        class="volume-slider"
        aria-describedby="alarm-volume-help"
      >
      <span class="volume-display" id="alarm-volume-display">{{ config.get('alarm_volume', 50) }}%</span>
    </div>
    <small id="alarm-volume-help" class="form-help">{{ t('alarm_volume_help') }}</small>
  </div>

  <!-- Hidden field for playlist URI -->
  <input type="hidden" id="playlist_uri" name="playlist_uri" value="{{ config.get('playlist_uri', '') }}">
  
  <!-- Options Section with Progressive Disclosure -->
  <details class="options-accordion" id="alarm-options">
    <summary class="options-accordion-header">
      <span>{{ t('further_options') }}</span>
      <svg class="accordion-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M7 10l5 5 5-5z"/>
      </svg>
    </summary>
    <div class="options-accordion-content">
      <!-- Fade-In Toggle -->
      <div class="toggle-switch">
        <label for="fade_in">{{ t('fade_in') }}</label>
        <input
          type="checkbox"
          id="fade_in"
          name="fade_in"
          {% if config.get('fade_in', False) %}checked{% endif %}
        >
        <label for="fade_in" class="switch"></label>
      </div>

      <!-- Shuffle Toggle -->
      <div class="toggle-switch">
        <label for="shuffle">{{ t('shuffle') }}</label>
        <input
          type="checkbox"
          id="shuffle"
          name="shuffle"
          {% if config.get('shuffle', False) %}checked{% endif %}
        >
        <label for="shuffle" class="switch"></label>
      </div>
    </div>
  </details>

  <!-- Enable Checkbox - consistent with other toggles -->
  <div class="toggle-switch enable-container">
    <span class="enable-label">{{ t('enable_alarm') }}</span>
    <input
      type="checkbox"
      id="enabled"
      name="enabled"
      class="enable-checkbox"
      {% if config.get('enabled', False) %}checked{% endif %}
    >
    <label for="enabled" class="switch"></label>
  </div>
</form>

<div id="active-alarm-mode" class="{% if not config.get('enabled', False) %}hidden{% endif %}">
  <h2 class="form-title">{{ t('alarm_active_title') }}</h2>

  <div class="toggle-switch enable-container">
    <span class="enable-label">{{ t('enable_alarm') }}</span>
    <input
      type="checkbox"
      id="enabled_active"
      name="enabled_active"
      class="enable-checkbox"
      {% if config.get('enabled', False) %}checked{% endif %}
    >
    <label for="enabled_active" class="switch"></label>
  </div>
</div>
