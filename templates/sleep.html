<div id="sleep-timer" role="status" aria-live="polite" class="timer-display">
  <!-- ✅ Filled by JavaScript - no static text needed -->
</div>

<!-- Empty State (shown when no sleep timer is active) -->
<div class="empty-state {% if sleep_status.active %}hidden{% endif %}" id="sleep-empty-state">
  <div class="empty-state-icon">
    <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M12.34 2.02C6.59 1.82 2 6.42 2 12c0 5.52 4.48 10 10 10 3.71 0 6.93-2.02 8.66-5.02-7.51-.25-12.09-8.43-8.32-14.96z"/>
      <path d="M15 4l1 2 2 1-2 1-1 2-1-2-2-1 2-1z" opacity="0.6"/>
      <path d="M19 10l.5 1 1 .5-1 .5-.5 1-.5-1-1-.5 1-.5z" opacity="0.4"/>
    </svg>
  </div>
  <h3 class="empty-state-title">{{ t('empty_sleep_title') }}</h3>
  <p class="empty-state-description">{{ t('empty_sleep_description') }}</p>
</div>

<!-- Sleep Configuration Form (shown when timer is inactive) -->
<form method="POST" id="sleep-form" aria-labelledby="sleep-form-title"
      data-current-sleep-playlist-uri="{{ config.get('sleep_playlist_uri', '') }}"
      class="{% if sleep_status.active %}hidden{% endif %}">
  <h2 id="sleep-form-title" class="form-title">{{ t('sleep_configure') }}</h2>
  
  <!-- Music Selection -->
  <div class="form-group">
    <div id="sleep-playlist-selector">
      <div class="playlist-input">
        <div class="playlist-preview">
          <div class="playlist-preview-image"><svg class="icon icon-2x" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg></div>
          <div class="playlist-preview-info">
            <div class="playlist-preview-name">{{ t('playlist_select_text') or 'Select music' }}</div>
            <div class="playlist-preview-meta"></div>
          </div>
        </div>
      </div>
    </div>
    <small id="sleep-playlist-help" class="form-help">{{ t('sleep_playlist_help') }}</small>
  </div>

  <!-- Device -->
  <div class="form-group">
    <label for="sleep-device-name">{{ t('device_label')|safe }}</label>
    <select 
      name="device_name" 
      id="sleep-device-name" 
      class="form-input" 
      required
      aria-describedby="sleep-device-help"
    >
      {% if not devices %}
        <option value="" disabled selected>{{ t('loading_devices') or 'Lade Geräte…' }}</option>
      {% endif %}
      {% for d in devices %}
        <option value="{{ d.name }}" {% if config.get('device_name') == d.name %}selected{% endif %}>
          {{ d.name }}
        </option>
      {% endfor %}
    </select>
    <small id="sleep-device-help" class="form-help">{{ t('device_help') }}</small>
  </div>

  <!-- Duration -->
  <div class="form-group">
    <label for="duration">{{ t('duration_label')|safe }}</label>
    <select 
      name="duration" 
      id="duration" 
      class="form-input"
      required
      aria-describedby="duration-help"
    >
      <option value="15" {% if config.get('sleep_duration') == '15' %}selected{% endif %}>{{ t('duration_15min') }}</option>
      <option value="30" {% if config.get('sleep_duration') == '30' %}selected{% endif %}>{{ t('duration_30min') }}</option>
      <option value="45" {% if config.get('sleep_duration') == '45' %}selected{% endif %}>{{ t('duration_45min') }}</option>
      <option value="60" {% if config.get('sleep_duration') == '60' %}selected{% endif %}>{{ t('duration_1h') }}</option>
      <option value="90" {% if config.get('sleep_duration') == '90' %}selected{% endif %}>{{ t('duration_15h') }}</option>
      <option value="120" {% if config.get('sleep_duration') == '120' %}selected{% endif %}>{{ t('duration_2h') }}</option>
      <option value="custom" {% if config.get('sleep_duration') == 'custom' %}selected{% endif %}>{{ t('duration_custom') }}</option>
    </select>
    <small id="duration-help" class="form-help">{{ t('duration_help') }}</small>
  </div>

  <!-- Custom Duration (hidden when not needed) -->
  <div id="custom-duration-container" class="custom-duration-container {% if config.get('sleep_duration') == 'custom' %}active{% endif %}">
    <div class="form-group">
      <label for="custom_duration">{{ t('custom_duration_label')|safe }}</label>
      <input 
        type="number" 
        id="custom_duration" 
        name="custom_duration" 
        class="form-input" 
        min="1" 
        max="240" 
        value="{{ config.get('sleep_custom_duration', '45') }}" 
        required
      >
    </div>
  </div>
  
  <!-- Hidden fields -->
  <input type="hidden" id="sleep-volume" name="volume" value="{{ initial_volume }}">
  <input type="hidden" name="playlist_uri" value="{{ config.get('sleep_playlist_uri', '') }}">

  <!-- Options with Progressive Disclosure -->
  <details class="options-accordion" id="sleep-options">
    <summary class="options-accordion-header">
      <span>{{ t('further_options') }}</span>
      <svg class="accordion-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M7 10l5 5 5-5z"/>
      </svg>
    </summary>
    <div class="options-accordion-content">
      <!-- Option: Only stop running music -->
      <div class="toggle-switch">
        <label for="stop_if_playing">{{ t('stop_if_playing') }}</label>
        <input
          type="checkbox"
          id="stop_if_playing"
          name="stop_if_playing"
          {% if config.get('stop_if_playing') %}checked{% endif %}
        >
        <label for="stop_if_playing" class="switch"></label>
      </div>

      <!-- Shuffle -->
      <div class="toggle-switch">
        <label for="sleep_shuffle">{{ t('shuffle') }}</label>
        <input
          type="checkbox"
          id="sleep_shuffle"
          name="shuffle"
          {% if config.get('shuffle') %}checked{% endif %}
        >
        <label for="sleep_shuffle" class="switch"></label>
      </div>
    </div>
  </details>

  <!-- Sleep Toggle Container in style of "Enable Container" -->
  <div class="toggle-switch enable-container">
    <span class="enable-label">{{ t('enable_sleep') }}</span>
    <input
      type="checkbox"
      id="sleep_enabled"
      name="sleep_enabled"
      class="enable-checkbox"
      {% if sleep_status.active %}checked{% endif %}
    >
    <label for="sleep_enabled" class="switch"></label>
  </div>
</form>

<!-- Active Sleep Timer Mode (shown when timer is active) -->
<div id="active-sleep-mode" class="{% if not sleep_status.active %}hidden{% endif %}">
  <h2 class="form-title">{{ t('sleep_active_title') }}</h2>
  <p class="muted-text">{{ t('sleep_active_info') }}</p>
  
  <div class="toggle-switch enable-container">
    <span class="enable-label">{{ t('enable_sleep') }}</span>
    <input
      type="checkbox"
      id="sleep_enabled_active"
      name="sleep_enabled"
      class="enable-checkbox"
      checked
    >
    <label for="sleep_enabled_active" class="switch"></label>
  </div>
</div>
